<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stellar KMP SDK - Standalone Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button {
            background: #4f46e5;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
        }
        button:hover {
            background: #4338ca;
        }
        #result {
            margin-top: 20px;
            padding: 15px;
            background: #f0f0f0;
            border-radius: 6px;
            font-family: monospace;
            word-break: break-all;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        .success { background: #10b981; color: white; }
        .error { background: #ef4444; color: white; }
        .info { background: #3b82f6; color: white; }
    </style>
</head>
<body>
    <div class="card">
        <h1>⭐ Stellar KMP SDK Test</h1>
        <div id="status" class="status info">Initializing SDK...</div>
        <button id="testBtn" disabled>Run Test</button>
        <div id="result"></div>
    </div>

    <!-- Load libsodium first -->
    <script src="./node_modules/libsodium-wrappers/dist/browsers/libsodium-wrappers.js"></script>

    <!-- Load Kotlin stdlib -->
    <script src="../stellar-sdk/build/dist/js/productionLibrary/kotlin-kotlin-stdlib.js"></script>

    <!-- Load the SDK -->
    <script src="../stellar-sdk/build/dist/js/productionLibrary/kmp-stellar-sdk-stellar-sdk.js"></script>

    <script>
        const statusDiv = document.getElementById('status');
        const resultDiv = document.getElementById('result');
        const testBtn = document.getElementById('testBtn');

        // Wait for SDK to load
        window.addEventListener('load', async () => {
            // Initialize libsodium
            await sodium.ready;
            window._sodium = sodium;
            console.log('libsodium initialized');

            setTimeout(() => {
                console.log('Window:', window);
                console.log('Window keys:', Object.keys(window));

                // Try different ways to access the SDK
                const sdkVariants = [
                    window['stellar-sdk'],
                    window.stellarSdk,
                    window.com,
                    window.stellar,
                    window.StellarSDK
                ];

                console.log('SDK variants:', sdkVariants);

                if (window.com && window.com.stellar && window.com.stellar.sdk) {
                    statusDiv.textContent = 'SDK Ready!';
                    statusDiv.className = 'status success';
                    testBtn.disabled = false;

                    const KeyPair = window.com.stellar.sdk.KeyPair;
                    console.log('KeyPair:', KeyPair);
                    console.log('KeyPair.Companion:', KeyPair.Companion);
                } else {
                    statusDiv.textContent = 'SDK not found in expected location';
                    statusDiv.className = 'status error';
                    resultDiv.innerHTML = '<pre>' + JSON.stringify(Object.keys(window), null, 2) + '</pre>';
                }
            }, 1000);
        });

        testBtn.addEventListener('click', () => {
            try {
                const KeyPair = window.com.stellar.sdk.KeyPair;

                // Test 1: Generate keypair
                const keypair = KeyPair.Companion.random();
                const accountId = keypair.getAccountId();

                resultDiv.innerHTML = `
                    <div><strong>✓ Keypair Generated</strong></div>
                    <div>Account ID: ${accountId}</div>
                    <div><strong>✓ Can Sign:</strong> ${keypair.canSign()}</div>
                    <div><strong>✓ Crypto Library:</strong> ${KeyPair.Companion.getCryptoLibraryName()}</div>
                `;

                statusDiv.textContent = 'Test Passed!';
                statusDiv.className = 'status success';
            } catch (error) {
                resultDiv.innerHTML = `<div style="color: red;"><strong>Error:</strong> ${error.message}</div>`;
                statusDiv.textContent = 'Test Failed';
                statusDiv.className = 'status error';
                console.error('Test error:', error);
            }
        });
    </script>
</body>
</html>
